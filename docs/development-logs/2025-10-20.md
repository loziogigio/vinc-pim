# Development Log - October 20, 2025

## VIC Storefront - Content Management System Expansion

---

## Executive Summary

Today's development session focuses on expanding the VIC Storefront admin capabilities to manage content for the customer_web (Hidros App) frontend. We are building four major content management systems: Product Detail CMS, Product Card Style Builder, Home Page Builder, and Menu Builder.

**Planned Achievements:**
- Product detail content management with media support
- Product card CSS/Tailwind customization builder
- Home page builder with live preview
- Hierarchical drag-and-drop menu builder

---

## Project Context

### Source Application (Builder/Admin)
**Location:** `/home/jire87/software/www-website/www-data/vendereincloud-app/vinc-apps/vinc-storefront`

**Purpose:** B2B Portal for managing B2B customer-facing content and components.

**Existing B2B Infrastructure:**
- **Route:** `http://localhost:3001/b2b/`
- **Product Detail Builder:** `/src/app/b2b/product-builder/page.tsx` âœ… ALREADY EXISTS
  - Full page builder with block library
  - Live preview with device modes
  - Version control and publishing
  - Product-specific content management
- **Catalog Manager:** `/src/app/b2b/(protected)/catalog/`
- **Dashboard:** `/src/app/b2b/(protected)/dashboard/`
- **Settings:** `/src/app/b2b/(protected)/settings/`
- **Shared Components:** Reuses `/src/components/builder/*` from admin page-builder

### Target Application (Frontend)
**Location:** `/home/jire87/software/www-website/www-data/hidros-app/customer_web`

**Purpose:** Customer-facing B2B e-commerce storefront.

**Key Components:**
- Product cards: `/src/components/product/product-cards/product-card-b2b.tsx`
- Home page: `/src/app/[lang]/(default)/page.tsx`
- Navigation menus: TBD (to be analyzed)

---

## Tasks Overview

### A - Product Detail Content Management System
**Status:** â¬œ Not Started
**Route:** `/b2b/product-builder?productId={sku}` (EXISTING - ENHANCE)

**Objective:** Enhance existing product-builder to add/replace media information (YouTube links, general links, attachments, rich content) on product detail pages.

**Current State:**
- âœ… Product detail page builder already exists at `/b2b/product-builder`
- âœ… Uses page-builder block system
- âœ… Supports version control and publishing
- â¬œ Needs media-specific blocks (YouTube, attachments, links, rich content)

**Sub-tasks:**
- [ ] A1: Create media block types for product-builder
  - [ ] YouTube embed block
  - [ ] File attachment block
  - [ ] External link block
  - [ ] Rich content block (with editor)
- [ ] A2: Implement media preview and management UI
- [ ] A3: Add product search/selection interface to catalog page
- [ ] A4: Create API endpoints for media storage and retrieval

**Technical Requirements:**
- Extend existing block metadata in `/src/components/builder/blockMetadata.ts`
- Add media-specific block components in `/src/components/blocks/`
- Database schema for product media content
- File upload handling (images, PDFs, etc.)
- YouTube API integration for embed previews
- Rich text editor (TipTap or similar)

---

### B - Product Card CSS Customization Builder
**Status:** â¬œ Not Started
**Route:** `/b2b/(protected)/settings/product-card-styles` (NEW)

**Objective:** Create a visual CSS/Tailwind customization interface for the product-card-b2b component in customer_web, allowing non-technical users to modify styling.

**Sub-tasks:**
- [ ] B1: Analyze product-card-b2b.tsx component structure and styling
- [ ] B2: Create new route `/b2b/(protected)/settings/product-card-styles`
- [ ] B3: Build visual style editor UI
  - [ ] Color pickers for badges, buttons, text
  - [ ] Spacing controls (padding, margins)
  - [ ] Typography controls (font size, weight)
  - [ ] Border and shadow controls
- [ ] B4: Implement live preview with sample product data
- [ ] B5: Create API endpoints to save/load style configurations
- [ ] B6: Apply styles dynamically in customer_web frontend

**Technical Requirements:**
- Color picker component (react-colorful or similar)
- Tailwind class generator utility
- Live preview iframe showing customer_web product cards
- Database schema for style presets
- API to fetch active styles in customer_web

**Component Analysis:**

**File:** `/src/components/product/product-cards/product-card-b2b.tsx`

**Key Style Sections:**
1. **Container:** Border, rounded corners, spacing
2. **Image Section:** Sizing, hover effects, badges
3. **Text Section:** Typography, colors, spacing
4. **Badges:** Parent SKU, PROMO badges
5. **Price Section:** Colors, font weights
6. **Button/CTA:** Background, hover states
7. **Favorite Icon:** Colors, positioning

---

### C - Home Page Builder
**Status:** â¬œ Not Started
**Route:** `/b2b/home-builder` (NEW - Similar to product-builder)

**Objective:** Create a home page builder with live preview for customer_web B2B homepage, reusing the existing page-builder pattern.

**Current State:**
- âœ… Page builder infrastructure exists (used in /b2b/product-builder)
- âœ… Block library system with drag-and-drop
- âœ… Version control and publishing workflow
- â¬œ Need to create B2B home-specific route and blocks

**Sub-tasks:**
- [ ] C1: Review current B2B home page structure in customer_web
- [ ] C2: Create new route `/b2b/home-builder`
- [ ] C3: Define home page specific block types
  - [ ] Hero banner block
  - [ ] Featured categories block
  - [ ] Product showcase block
  - [ ] CTA sections
  - [ ] Announcement banners
- [ ] C4: Set up page config for "b2b-home" slug
- [ ] C5: Implement preview that shows customer_web B2B home page
- [ ] C6: Test publish workflow to customer_web

**Technical Requirements:**
- Copy and adapt `/b2b/product-builder/page.tsx` to `/b2b/home-builder/page.tsx`
- Create home-specific blocks in `/src/components/blocks/`
- Use slug format: "b2b-home" instead of "product-detail"
- Reuse all existing builder components (BlockLibrary, Canvas, LivePreview, etc.)
- Live preview URL: customer_web B2B home page

---

### D - Menu Builder
**Status:** â¬œ Not Started
**Route:** `/b2b/(protected)/settings/menu-builder` (NEW)

**Objective:** Analyze current navigation menu structure in customer_web and create a drag-and-drop hierarchical menu builder for B2B portal.

**Sub-tasks:**
- [ ] D1: Analyze current menu structure in customer_web
  - [ ] Find main navigation component
  - [ ] Identify menu data source
  - [ ] Document current menu structure
- [ ] D2: Create new route `/b2b/(protected)/settings/menu-builder`
- [ ] D3: Build hierarchical tree UI
  - [ ] Tree view component
  - [ ] Drag-and-drop to reorder and nest items
  - [ ] Add/edit/delete menu items
- [ ] D4: Create menu item editor
  - [ ] Label (multi-language support?)
  - [ ] Link/URL
  - [ ] Icon selection
  - [ ] Visibility toggle
  - [ ] Open in new tab option
- [ ] D5: Implement preview mode
- [ ] D6: Create API endpoints for menu CRUD operations
- [ ] D7: Integrate with customer_web navigation

**Technical Requirements:**
- `@dnd-kit/core` and `@dnd-kit/sortable` - Drag and drop (already available)
- Tree data structure with parent-child relationships
- Database schema for menu configurations
- Icon picker component or icon library
- Multi-language support (if needed)
- API to fetch menu config in customer_web

---

## Summary - What We're Building

All features will be built in the **B2B Portal** (`http://localhost:3001/b2b/`) to manage content for the customer_web B2B storefront.

### Routes Overview

| Feature | Route | Status | Description |
|---------|-------|--------|-------------|
| **Product Detail Builder** | `/b2b/product-builder` | âœ… EXISTS | Already built - needs media blocks |
| **Product Card Styles** | `/b2b/(protected)/settings/product-card-styles` | â¬œ NEW | Visual CSS editor for product cards |
| **Home Page Builder** | `/b2b/home-builder` | â¬œ NEW | Build B2B home page (similar to product-builder) |
| **Menu Builder** | `/b2b/(protected)/settings/menu-builder` | â¬œ NEW | Drag-and-drop menu hierarchy editor |

### Key Insight
We can **reuse the existing page-builder infrastructure** that's already working in `/b2b/product-builder`! We just need to:
- Add new block types (media blocks for Task A)
- Create new routes for home builder and menu builder
- Build style customization UI for product cards

---

## Implementation Plan

### Phase 1: Analysis and Planning âœ… COMPLETED
- [x] Explore vinc-storefront project structure
- [x] Explore B2B route structure
- [x] Review existing /b2b/product-builder implementation
- [x] Analyze product-card-b2b.tsx component
- [x] Create development log structure with checkboxes
- [x] **DISCOVERED**: Product detail pages already use block system!
- [x] **DISCOVERED**: Complete architecture flow documented below

#### Architecture Discovery (Task A)

**Complete Flow:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /b2b/product-builderâ”‚  â† Admin edits blocks with drag-and-drop
â”‚  (vinc-storefront)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Save with versioning
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB             â”‚  â† Stores ProductTemplate documents
â”‚ ProductTemplate     â”‚     with versions array (like page-builder)
â”‚  - templateId       â”‚
â”‚  - type: product/   â”‚
â”‚    category/default â”‚
â”‚  - versions[]       â”‚
â”‚  - currentVersion   â”‚
â”‚  - currentPublished â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Fetch on SSR
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ customer_web        â”‚  â† Renders product detail page
â”‚ /products/[slug]    â”‚
â”‚  - BlockRenderer    â”‚
â”‚  - Existing blocks: â”‚
â”‚    â€¢ ProductInfo    â”‚
â”‚    â€¢ RichText       â”‚
â”‚    â€¢ CustomHTML     â”‚
â”‚    â€¢ Suggestions    â”‚
â”‚    â€¢ Spacer         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**What We Need to Build:**
1. âœ… Block system exists
2. âœ… Version control exists
3. âœ… MongoDB integration exists
4. âœ… Preview system exists
5. â¬œ **ADD**: Media-specific blocks (YouTube, FileAttachment, ExternalLink, MediaGallery)
6. â¬œ **ADD**: CDN integration for file uploads
7. â¬œ **ADD**: Block metadata in vinc-storefront builder

### Phase 2: Foundation
- [ ] Set up shared utilities and types
- [ ] Create database schemas
- [ ] Design API endpoints
- [ ] Set up shared UI components

### Phase 3: Implementation (Priority Order TBD)
**Option A: Start with C (Home Builder)** - Leverage existing infrastructure
**Option B: Start with A (Product Detail CMS)** - Highest business impact
**Option C: Start with B (Product Card Builder)** - Quick win
**Option D: Start with D (Menu Builder)** - Foundation for navigation

### Phase 4: Integration and Testing
- [ ] End-to-end testing
- [ ] User acceptance testing
- [ ] Documentation and training materials

---

## Technical Architecture

### Database Design (MongoDB)

#### Product Detail Content Collection
```typescript
interface ProductDetailContent {
  _id: ObjectId;
  sku: string; // Product identifier
  media: {
    type: 'youtube' | 'link' | 'attachment' | 'rich-content';
    url?: string;
    title: string;
    description?: string;
    order: number;
    preview?: string; // For thumbnails
  }[];
  createdAt: Date;
  updatedAt: Date;
  createdBy: string;
}
```

#### Product Card Styles Collection
```typescript
interface ProductCardStyle {
  _id: ObjectId;
  name: string; // Style preset name
  styles: {
    container: string; // Tailwind classes
    image: string;
    text: string;
    badges: string;
    price: string;
    button: string;
  };
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

#### Home Page Config Collection (Extend Page Builder)
```typescript
// Reuse existing PageConfig structure
// Add home-specific block types
```

#### Menu Collection
```typescript
interface MenuItem {
  id: string;
  label: string;
  link?: string;
  icon?: string;
  children?: MenuItem[];
  order: number;
  isVisible: boolean;
}

interface MenuConfig {
  _id: ObjectId;
  name: string;
  slug: string; // e.g., 'main-menu', 'footer-menu'
  items: MenuItem[];
  version: number;
  publishedVersion?: number;
  createdAt: Date;
  updatedAt: Date;
}
```

---

## API Endpoints (To Be Created)

### Product Detail CMS
```
GET    /api/products/:sku/content          - Get product detail content
POST   /api/products/:sku/content          - Save product detail content
DELETE /api/products/:sku/content/:mediaId - Delete media item
GET    /api/products/search                - Search products for selection
```

### Product Card Styles
```
GET    /api/product-card-styles            - Get all style presets
GET    /api/product-card-styles/:id        - Get specific style
POST   /api/product-card-styles            - Create new style preset
PUT    /api/product-card-styles/:id        - Update style preset
DELETE /api/product-card-styles/:id        - Delete style preset
POST   /api/product-card-styles/:id/activate - Activate style preset
```

### Home Page Builder
```
GET    /api/pages/home                     - Get home page config
POST   /api/pages/home/save-draft          - Save draft
POST   /api/pages/home/publish             - Publish version
(Reuse existing page-builder endpoints)
```

### Menu Builder
```
GET    /api/menus/:slug                    - Get menu config
POST   /api/menus/:slug/save-draft         - Save draft
POST   /api/menus/:slug/publish            - Publish menu
DELETE /api/menus/:slug/items/:id          - Delete menu item
```

---

## Development Notes

### Dependencies to Install
```json
{
  "@dnd-kit/core": "^6.0.0", // Already installed
  "@dnd-kit/sortable": "^7.0.0", // Check if installed
  "@dnd-kit/utilities": "^3.0.0",
  "react-quill": "^2.0.0", // Rich text editor for product details
  "react-youtube": "^10.1.0" // YouTube embed component
}
```

### Existing Components to Reuse
- `/src/components/builder/*` - Page builder components
- `/src/components/ui/*` - Shadcn UI components
- `/src/lib/store/pageBuilderStore.ts` - State management pattern
- `/src/lib/db/*` - Database utilities

---

## Session Progress Tracker

### Today's Session (October 20, 2025)

#### Morning Session
- [x] 09:00 - Project exploration and planning
- [x] 09:30 - Created development log structure
- [ ] 10:00 - Begin first implementation task

#### Afternoon Session
- [ ] 14:00 - Continue implementation
- [ ] 15:00 - Testing and debugging
- [ ] 16:00 - Documentation updates

---

## Decisions Log

### Decision 1: Use B2B Route Instead of Admin Route
**Date:** 2025-10-20 09:30
**Status:** âœ… CONFIRMED
**Decision:** Build all features under `/b2b/` route, not `/admin/`
**Rationale:** We're managing B2B customer-facing components, not the main storefront. The B2B portal already has product-builder at `/b2b/product-builder` which we can extend and replicate.

---

### Decision 2: Task Priority Order
**Date:** 2025-10-20 09:40
**Status:** â³ Pending User Input
**Options:**
1. **Task A - Product Detail Media Blocks** (Extend existing product-builder)
   - Extend `/b2b/product-builder` with new block types
   - Immediate value for product content
   - Effort: Medium (just add new block types)

2. **Task C - Home Page Builder** (Create new route)
   - Copy from product-builder and adapt
   - Quick win - mostly configuration
   - Effort: Medium (new route + home-specific blocks)

3. **Task B - Product Card Style Editor** (New settings page)
   - Visual tool with live preview
   - Standalone feature in settings
   - Effort: High (complex UI controls)

4. **Task D - Menu Builder** (New settings page)
   - Clear structure with tree UI
   - Effort: High (drag-drop tree + menu integration)

**Recommended Order:** A â†’ C â†’ B â†’ D

**Rationale:** Start with Task A (media blocks) since product-builder already exists, then Task C (home builder) for quick replication, then B and D which are more complex standalone features.

**Decision:** TBD - Awaiting user input

---

## Blockers and Questions

### Open Questions
1. Which task should we prioritize first (A, B, C, or D)?
2. What specific media types are needed for product details?
3. Are there existing product detail pages to analyze?
4. What menu structure is currently in use?
5. Should product card styles be global or per-category?

### Blockers
- None currently

---

## Resources and References

### Documentation
- Existing Page Builder: `/docs/WHAT_WE_BUILT.md`
- Architecture: `/docs/PROJECT_ARCHITECTURE.md`
- Previous Session: `/docs/development-logs/2025-10-15.md`

### Key Files Referenced
- Page Builder: `/src/app/admin/(protected)/page-builder/page.tsx`
- Product Card: `/customer_web/src/components/product/product-cards/product-card-b2b.tsx`
- Block Library: `/src/components/builder/BlockLibrary.tsx`

---

## Next Steps

### Immediate Actions
1. Get user input on task priority
2. Begin implementation of selected task
3. Create database schemas
4. Set up API endpoints
5. Build UI components

### Future Enhancements
- Multi-language support for content
- A/B testing for product card styles
- Analytics integration
- Scheduled content publishing
- Content approval workflows

---

## Progress Update - Task A In Progress

### âœ… Completed Today (2025-10-20)
1. **Architecture Discovery**
   - Documented complete flow: product-builder â†’ MongoDB â†’ customer_web
   - Verified catalog integration with product-builder links
   - Found existing block system in customer_web product pages

2. **Catalog API Integration**
   - Updated `/api/b2b/catalog/route.ts` to proxy customer_web search API
   - Now uses the same `/search/search` endpoint as customer_web
   - Added `CUSTOMER_WEB_URL` environment variable
   - Updated `.env.example` with documentation

### ğŸ“‹ Next Steps (Immediate)
1. Add `CUSTOMER_WEB_URL=http://localhost:3000` to `.env.local` in vinc-storefront
2. Test catalog page loads correctly with new API
3. Begin creating media block components

### ğŸ”§ Files Modified
- `/src/app/api/b2b/catalog/route.ts` - Updated to proxy customer_web search
- `/.env.example` - Added CUSTOMER_WEB_URL variable

---

*Document Status: In Progress*
*Created: 2025-10-20 09:00*
*Last Updated: 2025-10-20 10:30*
*Author: Development Team*
